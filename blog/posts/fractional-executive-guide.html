<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>What is a Fractional Executive? A Complete Guide | Lee Foropoulos</title>
  <meta name="description" content="Everything you need to know about fractional executive leadership - what it is, how it works, and whether it's right for your business.">
  <meta name="ambient:music" content="cinematic-inspiring">

  <meta property="og:type" content="article">
  <meta property="og:title" content="The Fractional Executive Guide: When and Why to Hire One">
  <meta property="og:description" content="Everything you need to know about fractional executives and when they make sense for your business.">
  <meta property="og:url" content="https://foropoulosnow.com/blog/posts/fractional-executive-guide.html">
  <meta property="og:image" content="https://res.cloudinary.com/foropoulosnow/image/fetch/w_1200,h_630,c_fill,q_auto,f_auto/https%3A%2F%2Fimages.unsplash.com%2Fphoto-1553877522-43269d4ea984">
  <meta property="article:author" content="Lee Foropoulos">
  <meta property="article:published_time" content="2025-12-20">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="The Fractional Executive Guide">
  <meta name="twitter:description" content="When and why to hire a fractional executive for your business.">
  <meta name="share:hook" content="Not every company needs a full-time C-suite. Here's when hiring a fractional executive makes more sense (and saves you 70% vs full-time):">
  <meta name="twitter:image" content="https://res.cloudinary.com/foropoulosnow/image/fetch/w_1200,h_630,c_fill,q_auto,f_auto/https%3A%2F%2Fimages.unsplash.com%2Fphoto-1553877522-43269d4ea984">
  <meta name="facebook-domain-verification" content="vx40czm6ccxtpl4crzqbiso70hmjoi" />

  <link rel="icon" type="image/svg+xml" href="../../favicon.svg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            navy: { 900: '#0f172a', 800: '#1e293b', 700: '#334155' },
            gold: { 600: '#d97706', 500: '#f59e0b', 400: '#fbbf24' }
          }
        }
      }
    }
  </script>
  <!-- Dark mode initialization (prevents flash) -->
  <script>
    (function() {
      function getCookie(name) {
        const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? match[2] : null;
      }
      const darkPref = getCookie('darkMode');
      if (darkPref === 'true' || (!darkPref && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
    .prose h2 { margin-top: 2.5rem; margin-bottom: 1rem; }
    .prose p { margin-bottom: 1.25rem; line-height: 1.8; }
    .prose ul, .prose ol { margin-bottom: 1.5rem; }
    .prose li { margin-bottom: 0.5rem; line-height: 1.7; }
    .prose blockquote { border-left: 4px solid #f59e0b; padding-left: 1.5rem; margin: 2rem 0; font-style: italic; }
    #back-to-top { opacity: 0; visibility: hidden; transition: all 0.3s ease; }
    #back-to-top.visible { opacity: 1; visibility: visible; }
    .content-image { border-radius: 0.75rem; margin: 2rem 0; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
    .share-buttons { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
    .share-btn { position: relative; display: inline-flex; align-items: center; justify-content: center; width: 2.75rem; height: 2.75rem; border-radius: 50%; transition: all 0.2s ease; border: none; cursor: pointer; }
    .share-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .share-btn svg { width: 1.25rem; height: 1.25rem; }
    .share-btn[data-tooltip]:hover::after { content: attr(data-tooltip); position: absolute; bottom: -2rem; left: 50%; transform: translateX(-50%); background: #0f172a; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; white-space: nowrap; z-index: 10; }
    .dark .share-btn[data-tooltip]:hover::after { background: #f59e0b; color: #0f172a; }
    .share-btn-x { background-color: #000; color: white; }
    .share-btn-linkedin { background-color: #0a66c2; color: white; }
    .share-btn-facebook { background-color: #1877f2; color: white; }
    .share-btn-copy { background-color: #f59e0b; color: #0f172a; }
    #copy-toast { position: fixed; bottom: 2rem; right: 2rem; background-color: #10b981; color: white; padding: 1rem 1.5rem; border-radius: 0.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.3); opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 50; }
    #copy-toast.show { opacity: 1; visibility: visible; }
  </style>
  <!-- Analytics: Google Analytics 4 + Microsoft Clarity -->
  <script src="/analytics.js" defer></script>
</head>
<body class="bg-white dark:bg-navy-900 text-gray-800 dark:text-gray-200">

  <!-- Navigation -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-navy-900/95 backdrop-blur-md border-b border-white/10">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <a href="../" class="text-white font-bold text-xl">Foropoulos<span class="text-gold-400">Now</span></a>
        <div class="flex items-center gap-4">
          <a href="../" class="text-gray-300 hover:text-gold-400 transition text-sm">Blog</a>
          <button id="dark-mode-toggle" class="text-gray-300 hover:text-gold-400 p-2" aria-label="Toggle dark mode">
            <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <header class="pt-24 pb-12 bg-gradient-to-br from-navy-900 via-navy-800 to-navy-900">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <a href="../" class="inline-flex items-center text-gold-400 hover:text-gold-300 mb-6 transition">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        Back to Blog
      </a>
      <div class="flex items-center gap-3 mb-4">
        <span class="bg-gold-500/20 text-gold-400 text-xs font-semibold px-3 py-1 rounded-full">Business</span>
        <span class="text-gray-400 text-sm">Dec 20, 2025</span>
        <span class="text-gray-500 text-sm">12 min read</span>
      </div>
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-6 leading-tight">
        What is a Fractional Executive? A Complete Guide
      </h1>
      <p class="text-xl text-gray-300 leading-relaxed">
        Everything you need to know about fractional leadership and how it can transform your business without the full-time commitment.
      </p>
      <!-- Quick Share Buttons -->
      <div class="flex items-center gap-2 mt-6">
        <span class="text-gray-400 text-sm mr-1">Share:</span>
        <button onclick="shareOnTwitter()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition" aria-label="Share on X">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        </button>
        <button onclick="shareOnLinkedIn()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition" aria-label="Share on LinkedIn">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
        </button>
        <button onclick="shareOnFacebook()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition" aria-label="Share on Facebook">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
        </button>
        <button onclick="copyLink()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 text-white flex items-center justify-center transition" aria-label="Copy Link">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Featured Image -->
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 -mt-6">
    <img src="https://images.unsplash.com/photo-1553877522-43269d4ea984?w=1200&h=600&fit=crop" alt="Executive business strategy meeting" class="w-full h-64 sm:h-80 object-cover rounded-2xl shadow-2xl">
  </div>

  <!-- Article Content -->
  <article class="py-12">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="prose dark:prose-invert max-w-none">

        <p class="text-lg text-gray-600 dark:text-gray-300 leading-relaxed">
          If you've been running a growing business, you've probably faced this dilemma: you need executive-level expertise, but hiring a full-time C-suite leader feels premature or financially out of reach. Enter the fractional executive, a solution that's been quietly revolutionizing how small and mid-sized companies scale.
        </p>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">What Exactly is a Fractional Executive?</h2>

        <p>
          A fractional executive is a seasoned leader who works with your company on a part-time basis, typically dedicating a "fraction" of their time, usually 10-20 hours per week or a set number of days per month. They bring the same strategic thinking, operational expertise, and leadership capabilities as a full-time hire, but at a fraction of the cost.
        </p>

        <p>
          Think of it this way: instead of paying $300,000+ annually for a full-time CEO, COO, or CTO (plus benefits, equity, and bonuses), you might pay $5,000-$15,000 per month for the strategic guidance you actually need. For many growing companies, this isn't just economical, it's optimal.
        </p>

        <!-- Inline Image -->
        <figure class="my-10">
          <img src="https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=800&h=450&fit=crop" alt="Business strategy session" class="content-image w-full">
          <figcaption class="text-center text-sm text-gray-500 dark:text-gray-400 mt-3">Strategic guidance without the full-time commitment</figcaption>
        </figure>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">Common Types of Fractional Executives</h2>

        <p>
          The fractional model works across virtually every C-suite role:
        </p>

        <ul class="space-y-3">
          <li><strong class="text-navy-900 dark:text-white">Fractional CEO:</strong> Provides strategic direction, board relations, and overall leadership during transitions or growth phases.</li>
          <li><strong class="text-navy-900 dark:text-white">Fractional COO:</strong> Streamlines operations, builds systems, and ensures day-to-day execution aligns with strategic goals.</li>
          <li><strong class="text-navy-900 dark:text-white">Fractional CTO:</strong> Guides technology strategy, manages technical teams, and makes critical architecture decisions.</li>
          <li><strong class="text-navy-900 dark:text-white">Fractional CFO:</strong> Handles financial strategy, fundraising support, and ensures fiscal health.</li>
          <li><strong class="text-navy-900 dark:text-white">Fractional CMO:</strong> Develops marketing strategy, brand positioning, and go-to-market plans.</li>
        </ul>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">When Does a Fractional Executive Make Sense?</h2>

        <p>
          The fractional model isn't right for everyone, but it's particularly powerful in these scenarios:
        </p>

        <div class="bg-gray-50 dark:bg-navy-800 rounded-xl p-6 my-8">
          <h3 class="font-bold text-navy-900 dark:text-white mb-4">Ideal Scenarios for Fractional Leadership</h3>
          <ol class="space-y-4">
            <li><strong>You're scaling past founder capabilities.</strong> You've built something great, but you're hitting operational or strategic walls that require expertise you don't have.</li>
            <li><strong>You need executive guidance without the overhead.</strong> Revenue is growing but not yet at the level to justify $300K+ salaries.</li>
            <li><strong>You're navigating a transition.</strong> M&A activity, founder departure, or strategic pivots often benefit from experienced outside leadership.</li>
            <li><strong>You need specialized expertise temporarily.</strong> Launching a new product line, expanding to new markets, or implementing new systems.</li>
            <li><strong>You want to test before committing.</strong> A fractional engagement can serve as an extended interview for a potential full-time role.</li>
          </ol>
        </div>

        <!-- Inline Image -->
        <figure class="my-10">
          <img src="https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&h=450&fit=crop" alt="Team collaboration meeting" class="content-image w-full">
          <figcaption class="text-center text-sm text-gray-500 dark:text-gray-400 mt-3">Fractional executives integrate seamlessly with your existing team</figcaption>
        </figure>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">The Real ROI of Fractional Leadership</h2>

        <p>
          Let's talk numbers. A typical full-time executive at a growth-stage company might cost:
        </p>

        <ul>
          <li>Base salary: $250,000-$400,000</li>
          <li>Benefits and taxes: $50,000-$80,000</li>
          <li>Equity: 1-5% of company</li>
          <li>Recruiting costs: $75,000-$150,000</li>
          <li><strong>Total first-year cost: $400,000-$700,000+</strong></li>
        </ul>

        <p>
          A fractional executive providing equivalent strategic value might cost $60,000-$180,000 annually. That's a 70-80% reduction in cost while potentially getting access to even more experienced talent, executives who've "been there, done that" multiple times across different companies.
        </p>

        <blockquote class="text-lg">
          "The best fractional executives don't just advise, they do. They roll up their sleeves and work alongside your team to implement the strategies they recommend."
        </blockquote>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">How to Work with a Fractional Executive</h2>

        <p>
          A successful fractional engagement requires clarity and structure:
        </p>

        <h3 class="text-xl font-semibold text-navy-900 dark:text-white mt-8 mb-4">1. Define Clear Objectives</h3>
        <p>
          What specific outcomes do you need? "Help us scale" is too vague. "Reduce customer churn from 8% to 4% within six months" gives everyone something concrete to work toward.
        </p>

        <h3 class="text-xl font-semibold text-navy-900 dark:text-white mt-8 mb-4">2. Establish Communication Rhythms</h3>
        <p>
          Weekly check-ins, access to key team members, and inclusion in critical meetings ensure your fractional leader can operate effectively without being physically present every day.
        </p>

        <h3 class="text-xl font-semibold text-navy-900 dark:text-white mt-8 mb-4">3. Give Them Authority to Act</h3>
        <p>
          A fractional executive without decision-making authority is just an expensive advisor. Define their scope clearly and empower them to make decisions within it.
        </p>

        <!-- Inline Image -->
        <figure class="my-10">
          <img src="https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=450&fit=crop" alt="Leadership presentation" class="content-image w-full">
          <figcaption class="text-center text-sm text-gray-500 dark:text-gray-400 mt-3">Clear communication and defined authority are essential</figcaption>
        </figure>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">Red Flags to Watch For</h2>

        <p>
          Not all fractional executives are created equal. Be cautious of:
        </p>

        <ul>
          <li><strong>All strategy, no execution:</strong> If they only want to create presentations and never implement, you're paying for consulting, not leadership.</li>
          <li><strong>Too many clients:</strong> If they're juggling 10+ companies, they can't give yours the attention it needs.</li>
          <li><strong>No relevant industry experience:</strong> Domain expertise matters. A fractional CTO who's never worked in SaaS shouldn't lead your SaaS technical strategy.</li>
          <li><strong>Unwillingness to commit to outcomes:</strong> The best fractional leaders tie their success to your success.</li>
        </ul>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">Making the Transition</h2>

        <p>
          Whether you eventually hire full-time or continue with fractional leadership indefinitely, the engagement should build lasting value. A good fractional executive:
        </p>

        <ul>
          <li>Documents processes and decisions</li>
          <li>Develops your internal team's capabilities</li>
          <li>Creates systems that work without them</li>
          <li>Prepares for a smooth handoff (to a full-time hire or your internal team)</li>
        </ul>

        <div class="bg-gold-50 dark:bg-gold-500/10 border border-gold-200 dark:border-gold-500/20 rounded-xl p-6 my-10">
          <h3 class="font-bold text-navy-900 dark:text-white mb-3">Ready to Explore Fractional Leadership?</h3>
          <p class="text-gray-700 dark:text-gray-300 mb-4">
            I provide fractional executive services as a CEO, COO, and CTO, helping companies scale operations, build teams, and implement technology strategies.
          </p>
          <a href="../../greek-fire-services" class="inline-flex items-center bg-gold-500 hover:bg-gold-400 text-navy-900 font-bold px-6 py-3 rounded-full transition">
            Learn About My Services
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
          </a>
        </div>

        <div class="my-10 py-8 border-t border-b border-gray-200 dark:border-gray-700">
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Share this article:</p>
          <div class="share-buttons">
            <button class="share-btn share-btn-x" onclick="shareOnTwitter()" aria-label="Share on X" data-tooltip="Share on X">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24h-6.514l-5.106-6.666-5.849 6.666h-3.31l7.73-8.835L2.45 2.25h6.63l4.872 6.444 5.292-6.444zM16.594 19.5h1.828L7.974 4.07H6.04l10.554 15.43z"></path></svg>
            </button>
            <button class="share-btn share-btn-linkedin" onclick="shareOnLinkedIn()" aria-label="Share on LinkedIn" data-tooltip="Share on LinkedIn">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.475-2.236-1.986-2.236-1.081 0-1.722.728-2.004 1.431-.103.249-.129.597-.129.946v5.428h-3.553v-11h3.413v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 9.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 10.019H3.555v-11h3.564v11zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.225 0z"></path></svg>
            </button>
            <button class="share-btn share-btn-facebook" onclick="shareOnFacebook()" aria-label="Share on Facebook" data-tooltip="Share on Facebook">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg>
            </button>
            <button class="share-btn share-btn-copy" onclick="copyLink()" aria-label="Copy Link" data-tooltip="Copy Link">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.658 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
            </button>
          </div>
        </div>

        <h2 class="text-2xl font-bold text-navy-900 dark:text-white">The Bottom Line</h2>

        <p>
          Fractional executives aren't a compromise, they're a strategic choice. For the right company at the right stage, fractional leadership provides access to top-tier talent, reduces risk, and accelerates growth without the overhead of traditional executive hiring.
        </p>

        <p>
          The question isn't whether you can afford a fractional executive. It's whether you can afford to navigate your next growth phase without one.
        </p>

      </div>
    </div>
  </article>

  <!-- Copy Toast Notification -->
  <div id="copy-toast">
    Link copied to clipboard!
  </div>

  <!-- Author Bio -->
  <section class="py-12 bg-gray-50 dark:bg-navy-800">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-start gap-6">
        <img src="../../headshot.png" alt="Lee Foropoulos" class="w-16 h-16 rounded-full object-cover">
        <div>
          <h3 class="font-bold text-navy-900 dark:text-white">Lee Foropoulos</h3>
          <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">Fractional Executive & NASM Certified Personal Trainer</p>
          <p class="text-gray-600 dark:text-gray-300 text-sm">20+ years building and scaling technology companies. I help businesses navigate growth challenges through fractional executive leadership.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Back to Top Button -->
  <!-- VOICE_READER -->
<!-- Voice Reader for Blog Posts -->
<div id="voice-reader" class="fixed bottom-24 right-8 z-40 flex flex-col items-end gap-2">
  <!-- Controls (hidden by default, shown when reading) -->
  <div id="voice-controls" class="hidden bg-navy-800 rounded-xl shadow-xl border border-white/10 p-4 mb-2 min-w-[200px]">
    <!-- Voice selector -->
    <div class="mb-3">
      <label class="text-gray-400 text-xs block mb-1">Voice</label>
      <select id="voice-select" class="w-full bg-navy-700 text-white text-sm rounded-lg px-3 py-2 border border-white/10 focus:border-gold-500 focus:outline-none">
        <option value="">Loading voices...</option>
      </select>
    </div>

    <!-- Speed controls -->
    <div class="flex items-center justify-between mb-3">
      <label class="text-gray-400 text-xs">Speed</label>
      <div class="flex items-center gap-2">
        <button id="voice-slower" class="p-1.5 text-gray-400 hover:text-gold-400 transition rounded hover:bg-white/5" title="Slower">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
          </svg>
        </button>
        <span id="voice-speed" class="text-white text-sm font-medium min-w-[3rem] text-center">1.0x</span>
        <button id="voice-faster" class="p-1.5 text-gray-400 hover:text-gold-400 transition rounded hover:bg-white/5" title="Faster">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Playback controls -->
    <div class="flex items-center justify-center gap-1 mb-3">
      <button id="voice-skip-back" class="p-2 text-gray-400 hover:text-gold-400 transition rounded hover:bg-white/5" title="Previous paragraph">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0019 16V8a1 1 0 00-1.6-.8l-5.333 4zM4.066 11.2a1 1 0 000 1.6l5.334 4A1 1 0 0011 16V8a1 1 0 00-1.6-.8l-5.334 4z"></path>
        </svg>
      </button>
      <button id="voice-stop" class="p-2 text-gray-400 hover:text-red-400 transition rounded hover:bg-white/5" title="Stop">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
        </svg>
      </button>
      <button id="voice-skip-forward" class="p-2 text-gray-400 hover:text-gold-400 transition rounded hover:bg-white/5" title="Next paragraph">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z"></path>
        </svg>
      </button>
    </div>

    <!-- Progress indicator -->
    <div class="text-xs text-gray-400 text-center">
      <span id="voice-progress">0</span> / <span id="voice-total">0</span> paragraphs
    </div>
  </div>

  <!-- Main Play/Pause Button -->
  <button id="voice-toggle" class="bg-gold-500 hover:bg-gold-400 text-navy-900 p-4 rounded-full shadow-lg transition transform hover:scale-110 group" title="Listen to article">
    <!-- Play icon -->
    <svg id="voice-play-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <!-- Pause icon (hidden by default) -->
    <svg id="voice-pause-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
  </button>
</div>

<style>
  /* Highlight currently reading element */
  .voice-reading {
    background: linear-gradient(90deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.2) 50%, rgba(245, 158, 11, 0.1) 100%);
    border-left: 3px solid #f59e0b;
    padding-left: 1rem;
    margin-left: -1rem;
    border-radius: 0 0.5rem 0.5rem 0;
    transition: all 0.3s ease;
  }

  .dark .voice-reading {
    background: linear-gradient(90deg, rgba(245, 158, 11, 0.05) 0%, rgba(245, 158, 11, 0.15) 50%, rgba(245, 158, 11, 0.05) 100%);
  }

  #voice-select {
    cursor: pointer;
  }
  #voice-select::-webkit-scrollbar {
    width: 6px;
  }
  #voice-select::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
  }
  #voice-select::-webkit-scrollbar-thumb {
    background: rgba(245, 158, 11, 0.5);
    border-radius: 3px;
  }
</style>

<script>
(function() {
  'use strict';

  // Check if Speech Synthesis is supported
  if (!('speechSynthesis' in window)) {
    const voiceReader = document.getElementById('voice-reader');
    if (voiceReader) voiceReader.style.display = 'none';
    return;
  }

  const synth = window.speechSynthesis;
  let utterance = null;
  let paragraphs = [];
  let currentIndex = 0;
  let isPlaying = false;
  let isPaused = false;
  let rate = 1.0;
  let selectedVoice = null;
  let voicesLoaded = false;

  // DOM elements
  const toggleBtn = document.getElementById('voice-toggle');
  const playIcon = document.getElementById('voice-play-icon');
  const pauseIcon = document.getElementById('voice-pause-icon');
  const controls = document.getElementById('voice-controls');
  const voiceSelect = document.getElementById('voice-select');
  const speedDisplay = document.getElementById('voice-speed');
  const progressDisplay = document.getElementById('voice-progress');
  const totalDisplay = document.getElementById('voice-total');
  const slowerBtn = document.getElementById('voice-slower');
  const fasterBtn = document.getElementById('voice-faster');
  const skipBackBtn = document.getElementById('voice-skip-back');
  const skipForwardBtn = document.getElementById('voice-skip-forward');
  const stopBtn = document.getElementById('voice-stop');

  // Voice quality scoring - prioritize more natural voices
  function scoreVoice(voice) {
    let score = 0;
    const name = voice.name.toLowerCase();
    const lang = voice.lang.toLowerCase();

    // Must be English
    if (!lang.startsWith('en')) return -1000;

    // Premium/Neural voices (most natural)
    if (name.includes('neural') || name.includes('natural') || name.includes('premium')) score += 100;

    // Google voices (Chrome) - very natural
    if (name.includes('google')) score += 80;

    // Microsoft voices (Edge) - also quite good
    if (name.includes('microsoft') && (name.includes('online') || name.includes('natural'))) score += 75;

    // Apple voices (Safari)
    if (name.includes('samantha') || name.includes('alex') || name.includes('karen')) score += 70;

    // Specific high-quality voices
    if (name.includes('zira') || name.includes('david') || name.includes('mark')) score += 60;

    // Enhanced/HD voices
    if (name.includes('enhanced') || name.includes('hd') || name.includes('compact') === false) score += 30;

    // Prefer US English for consistency
    if (lang === 'en-us' || lang === 'en_us') score += 20;

    // Prefer female voices (often clearer for narration)
    if (name.includes('female') || name.includes('zira') || name.includes('samantha') || name.includes('karen') || name.includes('victoria')) score += 10;

    // Local voices are usually lower quality
    if (voice.localService && !name.includes('google') && !name.includes('microsoft')) score -= 20;

    return score;
  }

  // Get and sort voices by quality
  function loadVoices() {
    const voices = synth.getVoices();
    if (voices.length === 0) return;

    // Filter English voices and sort by quality score
    const englishVoices = voices
      .filter(v => v.lang.toLowerCase().startsWith('en'))
      .map(v => ({ voice: v, score: scoreVoice(v) }))
      .sort((a, b) => b.score - a.score)
      .map(v => v.voice);

    if (englishVoices.length === 0) return;

    // Populate dropdown
    voiceSelect.innerHTML = '';
    englishVoices.forEach((voice, index) => {
      const option = document.createElement('option');
      option.value = index;
      // Clean up voice name for display
      let displayName = voice.name
        .replace('Microsoft ', '')
        .replace('Google ', '')
        .replace(' Online (Natural)', ' (Natural)')
        .replace(' - English (United States)', '')
        .replace(' (United States)', ' (US)')
        .replace(' (United Kingdom)', ' (UK)')
        .replace(' (Australia)', ' (AU)');
      option.textContent = displayName;
      option.dataset.voiceName = voice.name;
      voiceSelect.appendChild(option);
    });

    // Select best voice by default
    selectedVoice = englishVoices[0];
    voiceSelect.value = '0';

    // Try to restore saved preference
    const savedVoice = localStorage.getItem('preferredVoice');
    if (savedVoice) {
      const savedIndex = englishVoices.findIndex(v => v.name === savedVoice);
      if (savedIndex !== -1) {
        selectedVoice = englishVoices[savedIndex];
        voiceSelect.value = savedIndex.toString();
      }
    }

    voicesLoaded = true;

    // Store voices for later reference
    voiceSelect._voices = englishVoices;
  }

  // Voice selection change
  voiceSelect.addEventListener('change', function() {
    const voices = this._voices;
    if (voices && voices[this.value]) {
      selectedVoice = voices[this.value];
      localStorage.setItem('preferredVoice', selectedVoice.name);

      // If currently playing, restart with new voice
      if (isPlaying && !isPaused) {
        synth.cancel();
        speakParagraph(currentIndex);
      }
    }
  });

  // Get article content
  function getArticleParagraphs() {
    const article = document.querySelector('article .prose');
    if (!article) return [];

    const elements = article.querySelectorAll('p, h2, h3, li');
    return Array.from(elements).filter(el => {
      const text = el.innerText.trim();
      return text.length > 0;
    });
  }

  // Update UI state
  function updateUI() {
    if (isPlaying && !isPaused) {
      playIcon.classList.add('hidden');
      pauseIcon.classList.remove('hidden');
      controls.classList.remove('hidden');
    } else if (isPaused) {
      playIcon.classList.remove('hidden');
      pauseIcon.classList.add('hidden');
      controls.classList.remove('hidden');
    } else {
      playIcon.classList.remove('hidden');
      pauseIcon.classList.add('hidden');
      controls.classList.add('hidden');
    }

    progressDisplay.textContent = currentIndex + 1;
    totalDisplay.textContent = paragraphs.length;
    speedDisplay.textContent = rate.toFixed(1) + 'x';
  }

  // Highlight current paragraph
  function highlightParagraph(index) {
    // Remove previous highlight
    document.querySelectorAll('.voice-reading').forEach(el => {
      el.classList.remove('voice-reading');
    });

    // Add highlight to current
    if (paragraphs[index]) {
      paragraphs[index].classList.add('voice-reading');

      // Smooth scroll to element
      const rect = paragraphs[index].getBoundingClientRect();
      const offset = window.innerHeight / 3;

      if (rect.top < 100 || rect.bottom > window.innerHeight - 100) {
        window.scrollTo({
          top: window.scrollY + rect.top - offset,
          behavior: 'smooth'
        });
      }
    }
  }

  // Speak a paragraph
  function speakParagraph(index) {
    if (index >= paragraphs.length) {
      stopReading();
      return;
    }

    currentIndex = index;
    highlightParagraph(index);
    updateUI();

    let text = paragraphs[index].innerText.trim();

    // Add natural pauses for better flow
    text = text
      .replace(/\. /g, '... ')  // Longer pause after sentences
      .replace(/\? /g, '?... ')
      .replace(/! /g, '!... ')
      .replace(/: /g, ':.. ')   // Medium pause after colons
      .replace(/; /g, ';.. ')
      .replace(/, /g, ', ');    // Keep commas natural

    utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = rate;
    utterance.pitch = 1.0;  // Keep pitch natural
    utterance.volume = 1.0;

    // Use selected voice
    if (selectedVoice) {
      utterance.voice = selectedVoice;
    }

    utterance.onend = function() {
      if (isPlaying && !isPaused) {
        // Small pause between paragraphs for natural flow
        setTimeout(() => {
          if (isPlaying && !isPaused) {
            speakParagraph(currentIndex + 1);
          }
        }, 300);
      }
    };

    utterance.onerror = function(e) {
      if (e.error !== 'interrupted' && e.error !== 'canceled') {
        console.error('Speech error:', e.error);
        speakParagraph(currentIndex + 1);
      }
    };

    synth.speak(utterance);
  }

  // Start reading
  function startReading() {
    paragraphs = getArticleParagraphs();
    if (paragraphs.length === 0) return;

    isPlaying = true;
    isPaused = false;

    if (synth.paused) {
      synth.resume();
    } else {
      speakParagraph(currentIndex);
    }

    updateUI();
  }

  // Pause reading
  function pauseReading() {
    isPaused = true;
    synth.pause();
    updateUI();
  }

  // Resume reading
  function resumeReading() {
    isPaused = false;
    synth.resume();
    updateUI();
  }

  // Stop reading
  function stopReading() {
    isPlaying = false;
    isPaused = false;
    currentIndex = 0;
    synth.cancel();

    // Remove highlights
    document.querySelectorAll('.voice-reading').forEach(el => {
      el.classList.remove('voice-reading');
    });

    updateUI();
  }

  // Toggle button click
  toggleBtn.addEventListener('click', function() {
    if (!isPlaying) {
      startReading();
    } else if (isPaused) {
      resumeReading();
    } else {
      pauseReading();
    }
  });

  // Stop button
  stopBtn.addEventListener('click', stopReading);

  // Speed controls
  slowerBtn.addEventListener('click', function() {
    rate = Math.max(0.5, rate - 0.1);
    speedDisplay.textContent = rate.toFixed(1) + 'x';
    if (isPlaying && !isPaused) {
      synth.cancel();
      speakParagraph(currentIndex);
    }
  });

  fasterBtn.addEventListener('click', function() {
    rate = Math.min(2.0, rate + 0.1);
    speedDisplay.textContent = rate.toFixed(1) + 'x';
    if (isPlaying && !isPaused) {
      synth.cancel();
      speakParagraph(currentIndex);
    }
  });

  // Skip controls
  skipBackBtn.addEventListener('click', function() {
    if (currentIndex > 0) {
      synth.cancel();
      speakParagraph(currentIndex - 1);
    }
  });

  skipForwardBtn.addEventListener('click', function() {
    if (currentIndex < paragraphs.length - 1) {
      synth.cancel();
      speakParagraph(currentIndex + 1);
    }
  });

  // Initialize
  paragraphs = getArticleParagraphs();
  totalDisplay.textContent = paragraphs.length;

  // Load voices (async in some browsers)
  loadVoices();
  if (synth.onvoiceschanged !== undefined) {
    synth.onvoiceschanged = loadVoices;
  }

  // Restore saved speed preference
  const savedRate = localStorage.getItem('preferredRate');
  if (savedRate) {
    rate = parseFloat(savedRate);
    speedDisplay.textContent = rate.toFixed(1) + 'x';
  }

  // Save speed on change
  const originalSlower = slowerBtn.onclick;
  const originalFaster = fasterBtn.onclick;
  slowerBtn.addEventListener('click', () => localStorage.setItem('preferredRate', rate.toFixed(1)));
  fasterBtn.addEventListener('click', () => localStorage.setItem('preferredRate', rate.toFixed(1)));

  // Stop when leaving page
  window.addEventListener('beforeunload', function() {
    synth.cancel();
  });

  // Handle visibility change (pause when tab hidden)
  document.addEventListener('visibilitychange', function() {
    if (document.hidden && isPlaying && !isPaused) {
      pauseReading();
    }
  });

})();
</script>

<!-- /VOICE_READER -->

<button id="back-to-top" class="fixed bottom-8 right-8 z-40 bg-gold-500 hover:bg-gold-400 text-navy-900 p-3 rounded-full shadow-lg transition transform hover:scale-110" aria-label="Back to top">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>

  <!-- Footer -->
  <footer class="bg-navy-900 border-t border-white/10 py-8">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <a href="../" class="text-white font-bold">Foropoulos<span class="text-gold-400">Now</span></a>
      <p class="text-gray-500 text-sm mt-2">&copy; 2026 Greek-Fire Corporation</p>
    </div>
  
    <!-- Legal Links -->
<div class="mt-8 pt-6 border-t border-white/10 flex flex-wrap justify-center gap-4 text-sm">
  <button id="cookie-settings-btn" class="text-gray-500 hover:text-gold-400 transition">Cookie Settings</button>
  <span class="text-gray-600">|</span>
  <a href="../../privacy" class="text-gray-500 hover:text-gold-400 transition">Privacy Policy</a>
</div>
  </footer>

  <script>
    // Back to top
    const backToTop = document.getElementById('back-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 500) {
        backToTop.classList.add('visible');
      } else {
        backToTop.classList.remove('visible');
      }
    });
    backToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Share functionality with engaging hooks
    function getShareData() {
      const title = document.querySelector('meta[property="og:title"]')?.content || document.title;
      const description = document.querySelector('meta[property="og:description"]')?.content || '';
      const url = document.querySelector('meta[property="og:url"]')?.content || window.location.href;
      const hook = document.querySelector('meta[name="share:hook"]')?.content || description;
      return { title, description, url, hook };
    }

    function shareOnTwitter() {
      const { hook, url } = getShareData();
      const text = hook;
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank', 'width=550,height=420');
    }

    function shareOnLinkedIn() {
      const { title, hook, url } = getShareData();
      const text = hook + '\n\nRead more:';
      window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, '_blank', 'width=550,height=420');
    }

    function shareOnFacebook() {
      const { hook, url } = getShareData();
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(hook)}`, '_blank', 'width=550,height=420');
    }

    function copyLink() {
      const { url } = getShareData();
      navigator.clipboard.writeText(url).then(() => {
        const toast = document.getElementById('copy-toast');
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
      });
    }
  </script>

<!-- MUSIC_PLAYER -->
<!-- Ambient Music Player -->
<div id="music-player" class="fixed bottom-8 left-8 z-[60] opacity-0 translate-y-4 transition-all duration-500">
  <!-- Expanded Player Panel -->
  <div id="music-panel" class="hidden mb-3 bg-navy-900/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden w-72">
    <!-- Track Visualizer Header -->
    <div class="relative h-24 bg-gradient-to-br from-gold-500/20 via-purple-500/20 to-blue-500/20 overflow-hidden">
      <div id="music-visualizer" class="absolute inset-0 flex items-end justify-center gap-1 px-4 pb-2">
        <!-- Equalizer bars generated by JS -->
      </div>
      <div class="absolute inset-0 bg-gradient-to-t from-navy-900/90 to-transparent"></div>
      <div class="absolute bottom-2 left-4 right-4">
        <p id="music-track-name" class="text-white font-semibold text-sm truncate">Select an atmosphere</p>
        <p id="music-track-artist" class="text-gray-400 text-xs truncate">Ambient Soundscape</p>
      </div>
    </div>

    <!-- Mood Selector -->
    <div class="p-4 border-b border-white/10">
      <label class="text-gray-400 text-xs block mb-2">Atmosphere</label>
      <select id="music-track-select" class="w-full bg-navy-800 text-white text-sm rounded-lg px-3 py-2.5 border border-white/10 focus:border-gold-500 focus:outline-none cursor-pointer">
        <option value="">Choose your vibe...</option>
        <optgroup label="Calm">
          <option value="peaceful">Peaceful Dreams</option>
          <option value="meditation">Deep Meditation</option>
          <option value="ocean">Ocean Waves</option>
        </optgroup>
        <optgroup label="Focus">
          <option value="focus">Deep Focus</option>
          <option value="ambient">Floating Ambient</option>
          <option value="minimal">Minimal Pulse</option>
        </optgroup>
        <optgroup label="Energy">
          <option value="cinematic">Cinematic Rise</option>
          <option value="dark">Dark Atmosphere</option>
          <option value="pulse">Energy Pulse</option>
        </optgroup>
      </select>
    </div>

    <!-- Playback Controls -->
    <div class="p-4 flex items-center justify-center gap-4">
      <button id="music-play-btn" class="w-14 h-14 rounded-full bg-gold-500 hover:bg-gold-400 text-navy-900 flex items-center justify-center transition transform hover:scale-105 shadow-lg">
        <svg id="music-play-icon" class="w-6 h-6 ml-1" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"></path>
        </svg>
        <svg id="music-pause-icon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 24 24">
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path>
        </svg>
      </button>
    </div>

    <!-- Volume Control -->
    <div class="px-4 pb-4">
      <div class="flex items-center gap-3">
        <button id="music-mute" class="text-gray-400 hover:text-white transition">
          <svg id="music-volume-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072M18.364 5.636a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
          </svg>
          <svg id="music-mute-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path>
          </svg>
        </button>
        <div id="music-volume-container" class="flex-1 h-2 bg-navy-700 rounded-full cursor-pointer relative">
          <div id="music-volume-bar" class="h-full bg-gradient-to-r from-gold-500 to-gold-400 rounded-full transition-all" style="width: 70%"></div>
          <div id="music-volume-handle" class="absolute top-1/2 -translate-y-1/2 w-4 h-4 bg-white rounded-full shadow-lg cursor-grab" style="left: 70%"></div>
        </div>
        <span id="music-volume-value" class="text-gray-400 text-xs w-8">70%</span>
      </div>
    </div>

    <!-- Attribution -->
    <div class="px-4 pb-3 text-center">
      <p class="text-gray-500 text-xs">Generative ambient soundscapes</p>
    </div>
  </div>

  <!-- Floating Toggle Button -->
  <button id="music-toggle" class="relative bg-navy-900/90 hover:bg-navy-800 backdrop-blur-xl text-white p-4 rounded-full shadow-2xl border border-white/10 transition-all duration-300 hover:scale-110 hover:border-gold-500/50 group" style="pointer-events: auto !important; z-index: 9999 !important;">
    <!-- Pulse ring animation when playing -->
    <div id="music-pulse" class="absolute inset-0 rounded-full border-2 border-gold-500/50 animate-ping hidden"></div>

    <!-- Music note icon -->
    <svg id="music-note-icon" class="w-6 h-6 text-gold-400 group-hover:text-gold-300 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
    </svg>

    <!-- Mini equalizer when playing -->
    <div id="music-eq-mini" class="absolute inset-0 flex items-center justify-center gap-0.5 hidden">
      <span class="w-1 h-3 bg-gold-400 rounded-full animate-eq-1"></span>
      <span class="w-1 h-4 bg-gold-400 rounded-full animate-eq-2"></span>
      <span class="w-1 h-2 bg-gold-400 rounded-full animate-eq-3"></span>
      <span class="w-1 h-3 bg-gold-400 rounded-full animate-eq-4"></span>
    </div>

    <!-- New badge for first-time visitors -->
    <span id="music-badge" class="absolute -top-1 -right-1 w-3 h-3 bg-gold-500 rounded-full hidden">
      <span class="absolute inset-0 rounded-full bg-gold-500 animate-ping"></span>
    </span>
  </button>

  <!-- Welcome notification -->
  <div id="music-welcome" class="absolute bottom-full left-0 mb-3 hidden opacity-0 transition-opacity duration-500 w-64">
    <div class="bg-navy-800/95 backdrop-blur-xl rounded-xl p-4 shadow-2xl border border-gold-500/20 relative">
      <div class="absolute -bottom-2 left-6 w-4 h-4 bg-navy-800/95 border-r border-b border-gold-500/20 transform rotate-45"></div>
      <div class="flex items-center gap-2 mb-2">
        <div class="w-8 h-8 rounded-full bg-gold-500/20 flex items-center justify-center">
          <svg class="w-4 h-4 text-gold-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
          </svg>
        </div>
        <span class="text-gold-400 font-semibold text-sm">Enhance Your Experience</span>
      </div>
      <p class="text-gray-300 text-xs leading-relaxed mb-3">
        Enable ambient soundscapes for an immersive browsing experience.
      </p>
      <div class="flex gap-2">
        <button id="music-welcome-play" class="flex-1 bg-gold-500 hover:bg-gold-400 text-navy-900 text-xs font-semibold py-2 px-3 rounded-lg transition transform hover:scale-105">
          Play Music
        </button>
        <button id="music-welcome-dismiss" class="px-3 py-2 text-gray-400 hover:text-white text-xs rounded-lg border border-white/10 hover:border-white/30 transition">
          Later
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  /* Player visibility */
  #music-player.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Equalizer animations */
  @keyframes eq-1 {
    0%, 100% { height: 4px; }
    50% { height: 16px; }
  }
  @keyframes eq-2 {
    0%, 100% { height: 8px; }
    50% { height: 20px; }
  }
  @keyframes eq-3 {
    0%, 100% { height: 12px; }
    50% { height: 8px; }
  }
  @keyframes eq-4 {
    0%, 100% { height: 6px; }
    50% { height: 14px; }
  }

  .animate-eq-1 { animation: eq-1 0.8s ease-in-out infinite; }
  .animate-eq-2 { animation: eq-2 0.6s ease-in-out infinite 0.1s; }
  .animate-eq-3 { animation: eq-3 0.7s ease-in-out infinite 0.2s; }
  .animate-eq-4 { animation: eq-4 0.5s ease-in-out infinite 0.15s; }

  /* Large visualizer bars */
  .visualizer-bar {
    width: 4px;
    background: linear-gradient(to top, #f59e0b, #fbbf24);
    border-radius: 2px;
    transition: height 0.1s ease;
  }

  /* Track select styling */
  #music-track-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1rem;
  }

  /* Welcome notification animations */
  #music-welcome.show {
    opacity: 1;
  }

  @keyframes welcome-glow {
    0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.2); }
    50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.4); }
  }

  #music-welcome.show > div {
    animation: welcome-glow 2s ease-in-out infinite;
  }
</style>

<script>
(function() {
  'use strict';

  // ===== CLEAR OLD CACHE =====
  const MUSIC_VERSION = '3';
  if (localStorage.getItem('musicVersion') !== MUSIC_VERSION) {
    localStorage.removeItem('musicTrack');
    localStorage.removeItem('musicEnabled');
    localStorage.removeItem('musicWelcomeSeen');
    localStorage.setItem('musicVersion', MUSIC_VERSION);
  }

  // ===== MOOD PRESETS =====
  const MOODS = {
    'peaceful': { name: 'Peaceful Dreams', type: 'pad', baseFreq: 220, color: 'warm' },
    'meditation': { name: 'Deep Meditation', type: 'drone', baseFreq: 110, color: 'deep' },
    'ocean': { name: 'Ocean Waves', type: 'noise', baseFreq: 0, color: 'cool' },
    'focus': { name: 'Deep Focus', type: 'binaural', baseFreq: 200, color: 'neutral' },
    'ambient': { name: 'Floating Ambient', type: 'pad', baseFreq: 330, color: 'ethereal' },
    'minimal': { name: 'Minimal Pulse', type: 'pulse', baseFreq: 55, color: 'minimal' },
    'cinematic': { name: 'Cinematic Rise', type: 'swell', baseFreq: 165, color: 'epic' },
    'dark': { name: 'Dark Atmosphere', type: 'dark', baseFreq: 82, color: 'dark' },
    'pulse': { name: 'Energy Pulse', type: 'pulse', baseFreq: 110, color: 'energy' }
  };

  // Map page ambient:music meta tags to our moods
  const PAGE_MOOD_MAP = {
    'classical-peaceful': 'peaceful',
    'classical-dramatic': 'cinematic',
    'classical-baroque': 'ambient',
    'electronic-ambient': 'ambient',
    'electronic-chill': 'focus',
    'electronic-dark': 'dark',
    'acoustic-guitar': 'peaceful',
    'acoustic-jazz': 'minimal',
    'cinematic-tension': 'dark',
    'cinematic-inspiring': 'cinematic'
  };

  // ===== STATE =====
  let audioContext = null;
  let masterGain = null;
  let nodes = [];
  let isPlaying = false;
  let currentMoodId = null;
  let volume = 0.7;
  let animationId = null;
  let analyser = null;

  // ===== DOM ELEMENTS =====
  const player = document.getElementById('music-player');
  if (!player) return;

  const panel = document.getElementById('music-panel');
  const toggleBtn = document.getElementById('music-toggle');
  const playBtn = document.getElementById('music-play-btn');
  const playIcon = document.getElementById('music-play-icon');
  const pauseIcon = document.getElementById('music-pause-icon');
  const trackSelect = document.getElementById('music-track-select');
  const trackName = document.getElementById('music-track-name');
  const trackArtist = document.getElementById('music-track-artist');
  const volumeBar = document.getElementById('music-volume-bar');
  const volumeHandle = document.getElementById('music-volume-handle');
  const volumeContainer = document.getElementById('music-volume-container');
  const volumeValue = document.getElementById('music-volume-value');
  const muteBtn = document.getElementById('music-mute');
  const volumeIcon = document.getElementById('music-volume-icon');
  const muteIcon = document.getElementById('music-mute-icon');
  const visualizer = document.getElementById('music-visualizer');
  const pulse = document.getElementById('music-pulse');
  const noteIcon = document.getElementById('music-note-icon');
  const eqMini = document.getElementById('music-eq-mini');
  const welcomeEl = document.getElementById('music-welcome');
  const welcomePlayBtn = document.getElementById('music-welcome-play');
  const welcomeDismissBtn = document.getElementById('music-welcome-dismiss');
  const musicBadge = document.getElementById('music-badge');

  // ===== PERSISTENCE =====
  function setMusicEnabled(enabled) {
    localStorage.setItem('musicEnabled', enabled ? 'true' : 'false');
  }

  function isMusicEnabled() {
    return localStorage.getItem('musicEnabled') === 'true';
  }

  // ===== WELCOME NOTIFICATION =====
  function showWelcome() {
    const hasSeenWelcome = localStorage.getItem('musicWelcomeSeen');
    if (hasSeenWelcome) return;
    if (musicBadge) musicBadge.classList.remove('hidden');
    setTimeout(() => {
      if (welcomeEl && !isPlaying) {
        welcomeEl.classList.remove('hidden');
        setTimeout(() => welcomeEl.classList.add('show'), 50);
      }
    }, 3000);
  }

  function hideWelcome(permanent = false) {
    if (welcomeEl) {
      welcomeEl.classList.remove('show');
      setTimeout(() => welcomeEl.classList.add('hidden'), 500);
    }
    if (musicBadge) musicBadge.classList.add('hidden');
    if (permanent) {
      localStorage.setItem('musicWelcomeSeen', 'true');
    }
  }

  // ===== AUDIO SYNTHESIS =====
  function initAudio() {
    if (audioContext) return;
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioContext.createGain();
    masterGain.gain.value = volume;
    masterGain.connect(audioContext.destination);

    // Create analyser for visualizer
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 64;
    masterGain.connect(analyser);
  }

  function stopAllNodes() {
    nodes.forEach(node => {
      try {
        if (node.stop) node.stop();
        if (node.disconnect) node.disconnect();
      } catch (e) {}
    });
    nodes = [];
  }

  function createPadSound(baseFreq, color) {
    const osc1 = audioContext.createOscillator();
    const osc2 = audioContext.createOscillator();
    const osc3 = audioContext.createOscillator();
    const gain1 = audioContext.createGain();
    const gain2 = audioContext.createGain();
    const gain3 = audioContext.createGain();
    const filter = audioContext.createBiquadFilter();

    // Frequencies for chord
    const freqs = color === 'warm' ? [baseFreq, baseFreq * 1.25, baseFreq * 1.5] :
                  color === 'ethereal' ? [baseFreq, baseFreq * 1.2, baseFreq * 1.498] :
                  [baseFreq, baseFreq * 1.189, baseFreq * 1.498];

    osc1.frequency.value = freqs[0];
    osc2.frequency.value = freqs[1];
    osc3.frequency.value = freqs[2];

    osc1.type = 'sine';
    osc2.type = 'sine';
    osc3.type = 'triangle';

    gain1.gain.value = 0.3;
    gain2.gain.value = 0.2;
    gain3.gain.value = 0.1;

    filter.type = 'lowpass';
    filter.frequency.value = 800;
    filter.Q.value = 1;

    osc1.connect(gain1);
    osc2.connect(gain2);
    osc3.connect(gain3);
    gain1.connect(filter);
    gain2.connect(filter);
    gain3.connect(filter);
    filter.connect(masterGain);

    // Slow LFO for movement
    const lfo = audioContext.createOscillator();
    const lfoGain = audioContext.createGain();
    lfo.frequency.value = 0.1;
    lfoGain.gain.value = 30;
    lfo.connect(lfoGain);
    lfoGain.connect(filter.frequency);

    osc1.start();
    osc2.start();
    osc3.start();
    lfo.start();

    nodes.push(osc1, osc2, osc3, lfo);
  }

  function createDroneSound(baseFreq) {
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();
    const filter = audioContext.createBiquadFilter();

    osc.frequency.value = baseFreq;
    osc.type = 'sawtooth';
    gain.gain.value = 0.15;
    filter.type = 'lowpass';
    filter.frequency.value = 400;

    osc.connect(gain);
    gain.connect(filter);
    filter.connect(masterGain);

    // Add subtle beating
    const osc2 = audioContext.createOscillator();
    const gain2 = audioContext.createGain();
    osc2.frequency.value = baseFreq + 1;
    osc2.type = 'sawtooth';
    gain2.gain.value = 0.15;
    osc2.connect(gain2);
    gain2.connect(filter);

    osc.start();
    osc2.start();
    nodes.push(osc, osc2);
  }

  function createNoiseSound() {
    const bufferSize = 2 * audioContext.sampleRate;
    const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
    const output = noiseBuffer.getChannelData(0);

    for (let i = 0; i < bufferSize; i++) {
      output[i] = Math.random() * 2 - 1;
    }

    const noise = audioContext.createBufferSource();
    noise.buffer = noiseBuffer;
    noise.loop = true;

    const filter = audioContext.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.value = 400;

    const gain = audioContext.createGain();
    gain.gain.value = 0.3;

    // LFO for wave-like movement
    const lfo = audioContext.createOscillator();
    const lfoGain = audioContext.createGain();
    lfo.frequency.value = 0.08;
    lfoGain.gain.value = 200;
    lfo.connect(lfoGain);
    lfoGain.connect(filter.frequency);

    noise.connect(filter);
    filter.connect(gain);
    gain.connect(masterGain);

    noise.start();
    lfo.start();
    nodes.push(noise, lfo);
  }

  function createBinauralSound(baseFreq) {
    // Left ear
    const oscL = audioContext.createOscillator();
    const gainL = audioContext.createGain();
    const panL = audioContext.createStereoPanner();
    oscL.frequency.value = baseFreq;
    oscL.type = 'sine';
    gainL.gain.value = 0.2;
    panL.pan.value = -1;

    // Right ear (slightly different frequency for binaural effect)
    const oscR = audioContext.createOscillator();
    const gainR = audioContext.createGain();
    const panR = audioContext.createStereoPanner();
    oscR.frequency.value = baseFreq + 10; // 10Hz binaural beat (alpha waves)
    oscR.type = 'sine';
    gainR.gain.value = 0.2;
    panR.pan.value = 1;

    oscL.connect(gainL);
    gainL.connect(panL);
    panL.connect(masterGain);

    oscR.connect(gainR);
    gainR.connect(panR);
    panR.connect(masterGain);

    oscL.start();
    oscR.start();
    nodes.push(oscL, oscR);
  }

  function createPulseSound(baseFreq, color) {
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();

    osc.frequency.value = baseFreq;
    osc.type = 'sine';

    // Pulsing gain
    const lfo = audioContext.createOscillator();
    const lfoGain = audioContext.createGain();
    lfo.frequency.value = color === 'energy' ? 2 : 0.5;
    lfoGain.gain.value = 0.15;

    gain.gain.value = 0.2;
    lfo.connect(lfoGain);
    lfoGain.connect(gain.gain);

    osc.connect(gain);
    gain.connect(masterGain);

    osc.start();
    lfo.start();
    nodes.push(osc, lfo);

    // Add harmonics
    const osc2 = audioContext.createOscillator();
    const gain2 = audioContext.createGain();
    osc2.frequency.value = baseFreq * 2;
    osc2.type = 'sine';
    gain2.gain.value = 0.08;
    osc2.connect(gain2);
    gain2.connect(masterGain);
    osc2.start();
    nodes.push(osc2);
  }

  function createDarkSound(baseFreq) {
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();
    const filter = audioContext.createBiquadFilter();

    osc.frequency.value = baseFreq;
    osc.type = 'sawtooth';
    gain.gain.value = 0.12;
    filter.type = 'lowpass';
    filter.frequency.value = 300;
    filter.Q.value = 5;

    osc.connect(gain);
    gain.connect(filter);
    filter.connect(masterGain);

    // Slow filter sweep
    const lfo = audioContext.createOscillator();
    const lfoGain = audioContext.createGain();
    lfo.frequency.value = 0.05;
    lfoGain.gain.value = 150;
    lfo.connect(lfoGain);
    lfoGain.connect(filter.frequency);

    osc.start();
    lfo.start();
    nodes.push(osc, lfo);
  }

  function createSwellSound(baseFreq) {
    createPadSound(baseFreq, 'epic');

    // Add rising element
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();
    osc.frequency.value = baseFreq / 2;
    osc.type = 'triangle';
    gain.gain.value = 0.1;

    osc.connect(gain);
    gain.connect(masterGain);

    // Slow pitch rise
    osc.frequency.setValueAtTime(baseFreq / 2, audioContext.currentTime);
    osc.frequency.linearRampToValueAtTime(baseFreq, audioContext.currentTime + 30);

    osc.start();
    nodes.push(osc);
  }

  function loadMood(moodId) {
    if (!MOODS[moodId]) return;

    initAudio();
    stopAllNodes();

    if (audioContext.state === 'suspended') {
      audioContext.resume();
    }

    const mood = MOODS[moodId];
    currentMoodId = moodId;

    switch (mood.type) {
      case 'pad':
        createPadSound(mood.baseFreq, mood.color);
        break;
      case 'drone':
        createDroneSound(mood.baseFreq);
        break;
      case 'noise':
        createNoiseSound();
        break;
      case 'binaural':
        createBinauralSound(mood.baseFreq);
        break;
      case 'pulse':
        createPulseSound(mood.baseFreq, mood.color);
        break;
      case 'dark':
        createDarkSound(mood.baseFreq);
        break;
      case 'swell':
        createSwellSound(mood.baseFreq);
        break;
    }

    if (trackName) trackName.textContent = mood.name;
    if (trackArtist) trackArtist.textContent = 'Generative Ambient';
    if (trackSelect) trackSelect.value = moodId;
  }

  function play() {
    if (!currentMoodId && trackSelect && trackSelect.value) {
      loadMood(trackSelect.value);
    } else if (!currentMoodId) {
      // Default to ambient
      loadMood('ambient');
    }

    if (audioContext && audioContext.state === 'suspended') {
      audioContext.resume();
    }

    isPlaying = true;
    setMusicEnabled(true);
    updatePlayButton();
    animateVisualizer();
    hideWelcome(true);
  }

  function pause() {
    stopAllNodes();
    isPlaying = false;
    updatePlayButton();
    if (animationId) {
      cancelAnimationFrame(animationId);
      animationId = null;
    }
  }

  function togglePlay() {
    if (isPlaying) {
      pause();
    } else {
      play();
    }
  }

  // ===== UI UPDATES =====
  function updatePlayButton() {
    if (isPlaying) {
      if (playIcon) playIcon.classList.add('hidden');
      if (pauseIcon) pauseIcon.classList.remove('hidden');
      if (pulse) pulse.classList.remove('hidden');
      if (noteIcon) noteIcon.classList.add('hidden');
      if (eqMini) eqMini.classList.remove('hidden');
    } else {
      if (playIcon) playIcon.classList.remove('hidden');
      if (pauseIcon) pauseIcon.classList.add('hidden');
      if (pulse) pulse.classList.add('hidden');
      if (noteIcon) noteIcon.classList.remove('hidden');
      if (eqMini) eqMini.classList.add('hidden');
    }
  }

  function updateVolumeUI() {
    const percent = volume * 100;
    if (volumeBar) volumeBar.style.width = `${percent}%`;
    if (volumeHandle) volumeHandle.style.left = `${percent}%`;
    if (volumeValue) volumeValue.textContent = `${Math.round(percent)}%`;

    if (volume === 0) {
      if (volumeIcon) volumeIcon.classList.add('hidden');
      if (muteIcon) muteIcon.classList.remove('hidden');
    } else {
      if (volumeIcon) volumeIcon.classList.remove('hidden');
      if (muteIcon) muteIcon.classList.add('hidden');
    }
  }

  // ===== VISUALIZER =====
  function createVisualizerBars() {
    if (!visualizer) return;
    visualizer.innerHTML = '';
    for (let i = 0; i < 32; i++) {
      const bar = document.createElement('div');
      bar.className = 'visualizer-bar';
      bar.style.height = '4px';
      visualizer.appendChild(bar);
    }
  }

  function animateVisualizer() {
    if (!isPlaying || !visualizer || !analyser) {
      if (animationId) cancelAnimationFrame(animationId);
      return;
    }

    const bars = visualizer.querySelectorAll('.visualizer-bar');
    const dataArray = new Uint8Array(analyser.frequencyBinCount);
    analyser.getByteFrequencyData(dataArray);

    bars.forEach((bar, i) => {
      const value = dataArray[i] || 0;
      const height = Math.max(4, (value / 255) * 60);
      bar.style.height = `${height}px`;
    });

    animationId = requestAnimationFrame(animateVisualizer);
  }

  // ===== EVENT HANDLERS =====
  function bindEvents() {
    if (toggleBtn && panel) {
      toggleBtn.addEventListener('click', () => {
        panel.classList.toggle('hidden');
        hideWelcome(true);
      });
    }

    if (welcomePlayBtn) {
      welcomePlayBtn.addEventListener('click', () => {
        hideWelcome(true);
        if (panel) panel.classList.remove('hidden');
        const pageMusicMeta = document.querySelector('meta[name="ambient:music"]');
        const pageTrack = pageMusicMeta ? pageMusicMeta.content : null;
        const moodId = PAGE_MOOD_MAP[pageTrack] || 'ambient';
        loadMood(moodId);
        play();
      });
    }

    if (welcomeDismissBtn) {
      welcomeDismissBtn.addEventListener('click', () => {
        hideWelcome(true);
        setMusicEnabled(false);
      });
    }

    if (playBtn) playBtn.addEventListener('click', togglePlay);

    if (trackSelect) {
      trackSelect.addEventListener('change', (e) => {
        if (e.target.value) {
          loadMood(e.target.value);
          play();
        }
      });
    }

    // Volume control
    if (volumeContainer) {
      volumeContainer.addEventListener('click', (e) => {
        const rect = volumeContainer.getBoundingClientRect();
        volume = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
        if (masterGain) masterGain.gain.value = volume;
        localStorage.setItem('musicVolume', volume);
        updateVolumeUI();
      });
    }

    if (muteBtn) {
      muteBtn.addEventListener('click', () => {
        volume = volume === 0 ? 0.7 : 0;
        if (masterGain) masterGain.gain.value = volume;
        updateVolumeUI();
      });
    }
  }

  // ===== INITIALIZATION =====
  function init() {
    const pageMusicMeta = document.querySelector('meta[name="ambient:music"]');
    const pageTrack = pageMusicMeta ? pageMusicMeta.content : null;
    const pageMood = PAGE_MOOD_MAP[pageTrack] || 'ambient';

    // Restore volume
    const savedVolume = localStorage.getItem('musicVolume');
    if (savedVolume) {
      volume = parseFloat(savedVolume);
      updateVolumeUI();
    }

    // Set default mood in selector
    if (trackSelect) trackSelect.value = pageMood;

    // Create visualizer
    createVisualizerBars();

    // Check if music was enabled
    const musicWasEnabled = isMusicEnabled();

    // Show player
    setTimeout(() => {
      player.classList.add('visible');

      if (musicWasEnabled) {
        loadMood(pageMood);
        play();
      } else {
        showWelcome();
      }
    }, 1000);

    bindEvents();
  }

  // Start when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

<!-- /MUSIC_PLAYER -->

<!-- COOKIE_CONSENT -->
<!-- Cookie Consent Banner -->
<div id="cookie-consent" class="fixed bottom-0 left-0 right-0 z-[100] transform translate-y-full transition-transform duration-500" role="dialog" aria-labelledby="cookie-consent-title" aria-describedby="cookie-consent-description">
  <div class="bg-navy-900/98 backdrop-blur-lg border-t border-white/10 shadow-2xl">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div class="flex-1">
          <h3 id="cookie-consent-title" class="text-white font-semibold text-lg mb-2">We value your privacy</h3>
          <p id="cookie-consent-description" class="text-gray-400 text-sm leading-relaxed">
            We use cookies to enhance your browsing experience, analyze site traffic, and personalize content.
            By clicking "Accept All", you consent to our use of cookies. You can manage your preferences anytime.
          </p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 lg:ml-8">
          <button id="cookie-customize" class="px-5 py-2.5 text-gray-300 hover:text-white border border-white/20 hover:border-white/40 rounded-full text-sm font-medium transition">
            Customize
          </button>
          <button id="cookie-reject" class="px-5 py-2.5 text-gray-300 hover:text-white border border-white/20 hover:border-white/40 rounded-full text-sm font-medium transition">
            Reject All
          </button>
          <button id="cookie-accept" class="px-6 py-2.5 bg-gold-500 hover:bg-gold-400 text-navy-900 rounded-full text-sm font-semibold transition transform hover:scale-105">
            Accept All
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div id="cookie-modal" class="fixed inset-0 z-[110] hidden" role="dialog" aria-modal="true" aria-labelledby="cookie-modal-title">
  <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" id="cookie-modal-backdrop"></div>
  <div class="fixed inset-0 overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4">
      <div class="bg-navy-800 rounded-2xl shadow-2xl max-w-lg w-full border border-white/10 transform transition-all">
        <div class="p-6 border-b border-white/10">
          <div class="flex items-center justify-between">
            <h3 id="cookie-modal-title" class="text-xl font-bold text-white">Cookie Preferences</h3>
            <button id="cookie-modal-close" class="text-gray-400 hover:text-white transition" aria-label="Close modal">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <p class="text-gray-400 text-sm mt-2">Manage your cookie preferences below. Essential cookies are always active as they're necessary for the site to function.</p>
        </div>

        <div class="p-6 space-y-4">
          <!-- Essential Cookies -->
          <div class="flex items-start justify-between p-4 bg-white/5 rounded-xl">
            <div class="flex-1 pr-4">
              <h4 class="text-white font-semibold">Essential Cookies</h4>
              <p class="text-gray-400 text-sm mt-1">Required for basic site functionality like navigation and secure access. Cannot be disabled.</p>
            </div>
            <div class="relative">
              <input type="checkbox" id="cookie-essential" checked disabled class="sr-only">
              <div class="w-11 h-6 bg-gold-500 rounded-full opacity-50 cursor-not-allowed">
                <div class="absolute top-0.5 left-5 w-5 h-5 bg-white rounded-full shadow"></div>
              </div>
            </div>
          </div>

          <!-- Analytics Cookies -->
          <div class="flex items-start justify-between p-4 bg-white/5 rounded-xl">
            <div class="flex-1 pr-4">
              <label for="cookie-analytics" class="text-white font-semibold cursor-pointer">Analytics Cookies</label>
              <p class="text-gray-400 text-sm mt-1">Help us understand how visitors interact with our site. We use Google Analytics and Microsoft Clarity.</p>
            </div>
            <label for="cookie-analytics" class="relative cursor-pointer">
              <input type="checkbox" id="cookie-analytics" class="sr-only peer">
              <div class="w-11 h-6 bg-gray-600 peer-checked:bg-gold-500 rounded-full transition-colors"></div>
              <div class="absolute top-0.5 left-0.5 peer-checked:left-5 w-5 h-5 bg-white rounded-full shadow transition-all"></div>
            </label>
          </div>

          <!-- Marketing Cookies -->
          <div class="flex items-start justify-between p-4 bg-white/5 rounded-xl">
            <div class="flex-1 pr-4">
              <label for="cookie-marketing" class="text-white font-semibold cursor-pointer">Marketing Cookies</label>
              <p class="text-gray-400 text-sm mt-1">Used to track visitors across websites to display relevant ads and measure campaign effectiveness.</p>
            </div>
            <label for="cookie-marketing" class="relative cursor-pointer">
              <input type="checkbox" id="cookie-marketing" class="sr-only peer">
              <div class="w-11 h-6 bg-gray-600 peer-checked:bg-gold-500 rounded-full transition-colors"></div>
              <div class="absolute top-0.5 left-0.5 peer-checked:left-5 w-5 h-5 bg-white rounded-full shadow transition-all"></div>
            </label>
          </div>
        </div>

        <div class="p-6 border-t border-white/10 flex justify-end gap-3">
          <button id="cookie-modal-reject" class="px-5 py-2.5 text-gray-300 hover:text-white border border-white/20 hover:border-white/40 rounded-full text-sm font-medium transition">
            Reject All
          </button>
          <button id="cookie-modal-save" class="px-6 py-2.5 bg-gold-500 hover:bg-gold-400 text-navy-900 rounded-full text-sm font-semibold transition">
            Save Preferences
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- /COOKIE_CONSENT -->

<!-- SHARED_SCRIPTS -->
<script>
// ===== COOKIE UTILITIES =====
function getCookie(name) {
  const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
  return match ? match[2] : null;
}

function setCookie(name, value, days) {
  const expires = new Date(Date.now() + days * 864e5).toUTCString();
  document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/; SameSite=Lax';
}

function deleteCookie(name) {
  document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
}

// ===== COOKIE CONSENT MANAGEMENT =====
const CookieConsent = {
  CONSENT_COOKIE: 'cookieConsent',
  CONSENT_VERSION: '1.0',

  getConsent() {
    const consent = getCookie(this.CONSENT_COOKIE);
    if (!consent) return null;
    try {
      return JSON.parse(decodeURIComponent(consent));
    } catch (e) {
      return null;
    }
  },

  setConsent(preferences) {
    const consent = {
      version: this.CONSENT_VERSION,
      timestamp: new Date().toISOString(),
      essential: true, // Always true
      analytics: preferences.analytics || false,
      marketing: preferences.marketing || false
    };
    setCookie(this.CONSENT_COOKIE, JSON.stringify(consent), 365);
    return consent;
  },

  hasConsent() {
    return this.getConsent() !== null;
  },

  hasAnalyticsConsent() {
    const consent = this.getConsent();
    return consent && consent.analytics === true;
  },

  hasMarketingConsent() {
    const consent = this.getConsent();
    return consent && consent.marketing === true;
  },

  showBanner() {
    const banner = document.getElementById('cookie-consent');
    if (banner) {
      banner.classList.remove('translate-y-full');
    }
  },

  hideBanner() {
    const banner = document.getElementById('cookie-consent');
    if (banner) {
      banner.classList.add('translate-y-full');
    }
  },

  showModal() {
    const modal = document.getElementById('cookie-modal');
    if (modal) {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      // Set checkboxes to current preferences
      const consent = this.getConsent() || { analytics: false, marketing: false };
      const analyticsCheckbox = document.getElementById('cookie-analytics');
      const marketingCheckbox = document.getElementById('cookie-marketing');
      if (analyticsCheckbox) analyticsCheckbox.checked = consent.analytics;
      if (marketingCheckbox) marketingCheckbox.checked = consent.marketing;
    }
  },

  hideModal() {
    const modal = document.getElementById('cookie-modal');
    if (modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = '';
    }
  },

  acceptAll() {
    const consent = this.setConsent({ analytics: true, marketing: true });
    this.hideBanner();
    this.hideModal();
    this.applyConsent(consent);
    if (typeof siteAnalytics !== 'undefined') {
      siteAnalytics.trackEvent('cookie_consent', { consent_type: 'accept_all' });
    }
  },

  rejectAll() {
    const consent = this.setConsent({ analytics: false, marketing: false });
    this.hideBanner();
    this.hideModal();
    this.applyConsent(consent);
  },

  savePreferences() {
    const analyticsCheckbox = document.getElementById('cookie-analytics');
    const marketingCheckbox = document.getElementById('cookie-marketing');
    const consent = this.setConsent({
      analytics: analyticsCheckbox ? analyticsCheckbox.checked : false,
      marketing: marketingCheckbox ? marketingCheckbox.checked : false
    });
    this.hideBanner();
    this.hideModal();
    this.applyConsent(consent);
    if (consent.analytics && typeof siteAnalytics !== 'undefined') {
      siteAnalytics.trackEvent('cookie_consent', { consent_type: 'custom', analytics: consent.analytics, marketing: consent.marketing });
    }
  },

  applyConsent(consent) {
    // Dispatch event for analytics.js to listen to
    window.dispatchEvent(new CustomEvent('cookieConsentUpdated', { detail: consent }));
  },

  init() {
    if (!this.hasConsent()) {
      // Show banner after a short delay for better UX
      setTimeout(() => this.showBanner(), 1000);
    } else {
      // Apply existing consent
      this.applyConsent(this.getConsent());
    }
  }
};

// ===== MOBILE MENU =====
function initMobileMenu() {
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const closeMenuBtn = document.getElementById('close-menu');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuOverlay = document.getElementById('menu-overlay');

  if (!mobileMenuBtn || !mobileMenu) return;

  function openMobileMenu() {
    mobileMenu.classList.add('open');
    if (menuOverlay) menuOverlay.classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function closeMobileMenu() {
    mobileMenu.classList.remove('open');
    if (menuOverlay) menuOverlay.classList.remove('open');
    document.body.style.overflow = '';
  }

  mobileMenuBtn.addEventListener('click', openMobileMenu);
  if (closeMenuBtn) closeMenuBtn.addEventListener('click', closeMobileMenu);
  if (menuOverlay) menuOverlay.addEventListener('click', closeMobileMenu);

  // Close menu when clicking a link
  mobileMenu.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', closeMobileMenu);
  });

  // Close on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileMenu.classList.contains('open')) {
      closeMobileMenu();
    }
  });
}

// ===== DARK MODE TOGGLE =====
function initDarkMode() {
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  const darkModeToggleMobile = document.getElementById('dark-mode-toggle-mobile');

  // Prevent duplicate initialization
  if (window._darkModeInitialized) return;
  window._darkModeInitialized = true;

  function toggleDarkMode() {
    document.documentElement.classList.toggle('dark');
    const isDark = document.documentElement.classList.contains('dark');
    setCookie('darkMode', isDark, 365);
  }

  if (darkModeToggle) darkModeToggle.addEventListener('click', toggleDarkMode);
  if (darkModeToggleMobile) darkModeToggleMobile.addEventListener('click', toggleDarkMode);
}

// ===== BACK TO TOP =====
function initBackToTop() {
  const backToTop = document.getElementById('back-to-top');
  if (!backToTop) return;

  function updateBackToTop() {
    if (window.scrollY > 500) {
      backToTop.classList.add('visible');
    } else {
      backToTop.classList.remove('visible');
    }
  }

  backToTop.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  window.addEventListener('scroll', updateBackToTop);
}

// ===== SCROLL REVEAL =====
function initScrollReveal() {
  const revealObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

  document.querySelectorAll('.reveal, .card-hover, .stagger-children').forEach(el => {
    revealObserver.observe(el);
  });
}

// ===== SMOOTH SCROLL =====
function initSmoothScroll() {
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      const href = this.getAttribute('href');
      if (href !== '#') {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          const headerOffset = 80;
          const elementPosition = target.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.scrollY - headerOffset;

          window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
          });
        }
      }
    });
  });
}

// ===== COOKIE CONSENT EVENT LISTENERS =====
function initCookieConsentListeners() {
  // Banner buttons
  const acceptBtn = document.getElementById('cookie-accept');
  const rejectBtn = document.getElementById('cookie-reject');
  const customizeBtn = document.getElementById('cookie-customize');

  if (acceptBtn) acceptBtn.addEventListener('click', () => CookieConsent.acceptAll());
  if (rejectBtn) rejectBtn.addEventListener('click', () => CookieConsent.rejectAll());
  if (customizeBtn) customizeBtn.addEventListener('click', () => {
    CookieConsent.hideBanner();
    CookieConsent.showModal();
  });

  // Modal buttons
  const modalClose = document.getElementById('cookie-modal-close');
  const modalBackdrop = document.getElementById('cookie-modal-backdrop');
  const modalReject = document.getElementById('cookie-modal-reject');
  const modalSave = document.getElementById('cookie-modal-save');

  if (modalClose) modalClose.addEventListener('click', () => CookieConsent.hideModal());
  if (modalBackdrop) modalBackdrop.addEventListener('click', () => CookieConsent.hideModal());
  if (modalReject) modalReject.addEventListener('click', () => CookieConsent.rejectAll());
  if (modalSave) modalSave.addEventListener('click', () => CookieConsent.savePreferences());

  // Footer cookie settings button
  const cookieSettingsBtn = document.getElementById('cookie-settings-btn');
  if (cookieSettingsBtn) cookieSettingsBtn.addEventListener('click', () => CookieConsent.showModal());

  // Note: Cookie toggles are now wrapped in <label> elements, so native browser behavior handles the toggle.
  // No additional JavaScript handlers needed for the toggle switches.
}

// ===== INITIALIZE ALL =====
function initAll() {
  initMobileMenu();
  initDarkMode();
  initBackToTop();
  initScrollReveal();
  initSmoothScroll();
  initCookieConsentListeners();
  CookieConsent.init();
}

// Handle both fresh page load and cases where DOM is already ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initAll);
} else {
  // DOM is already ready, initialize immediately
  initAll();
}

// Expose CookieConsent for external use
window.CookieConsent = CookieConsent;
</script>

<!-- /SHARED_SCRIPTS -->
</body>
</html>
